<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Library | Nexus</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('order.static', filename='gamer_library.css') }}" />
  </head>
  <body>
    <header class="navbar">
        <div class="navbar-left">
            <div class="logo">
                <a href="{{ url_for('auth.gamer_homepage', gamer_id=gamer_id) }}">
                  <img src="{{ url_for('auth.static', filename='nexus_logo.png') }}" alt="NEXUS Logo" class="logo-img">
                </a>
            </div>
        </div>
        <nav class="navbar-links">
            <a href="{{ url_for('order.library', gamer_id=gamer_id) }}" class="nav-link active">LIBRARY</a>
            <a href="{{ url_for('gamer.storepage', gamer_id=gamer_id) }}" class="nav-link">STORE</a>
            <a href="{{ url_for('order.show_cart', gamer_id=gamer_id) }}" class="nav-link">CART</a>
            <a href="{{ url_for('wallet.walletpage', gamer_id=gamer_id) }}" class="nav-link">WALLET</a>
            <a href="{{ url_for('auth.logout_controller') }}" class="nav-link">LOGOUT</a>
        </nav>
    </header>

    <section class="library">
      <div id="products">
        {% for game in games %}
          <div class="card {% if game.status != 1 %}unavailable{% endif %}">
            <img src="{{ game.image }}" alt="{{ game.name }}" />
            <div class="info">
              <h3>{{ game.name }}</h3>
              <p>Genre: {{ game.genre }}</p>

              {% if game.status != 1 %}
                <p class="status-text">Status: Non Available</p>
              {% endif %}

              <button class="uninstallButton"
                {% if game.status != 1 %}disabled{% endif %}
                onclick="uninstallGame('{{ game.id }}')"
              >Uninstall</button>
            </div>
          </div>
        {% endfor %}
      </div>
    </section>

    <script>
      function uninstallGame(gameId) {
        const yakin = confirm("Yakin ingin menghapus game ini dari library?");
        if (!yakin) return;

        fetch(`/order/uninstall/{{ gamer_id }}/${gameId}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.status === "success") {
              alert("Game berhasil dihapus dari library.");
              location.reload();
            } else {
              alert("Gagal uninstall: " + data.message);
            }
          })
          .catch((err) => {
            alert("Terjadi kesalahan: " + err);
          });
      }
    </script>
  </body>
</html>
