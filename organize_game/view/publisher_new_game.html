<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Publisher â€“ {{ 'Edit Game' if is_edit else 'Add New Game' }}</title>
    <link rel="stylesheet" href="{{ url_for('publisher.static', filename='publisher_new_game.css') }}" />
</head>

<body>
    <div class="navbar">
      <a
        class="publisher-title"
        href="{{ url_for('publisher.publisher_homepage', publisher_id=publisher_id) }}"
        >Publisher Panel</a
      >
    </div>

    <div class="container">
        <div class="sidebar">
            <a href="{{ url_for('publisher.published_games', publisher_id=publisher_id) }}">My Games</a>
            <a href="{{ url_for('publisher.add_new_game', publisher_id=publisher_id) }}" class="{{ '' if is_edit else 'active' }}">Add New Games</a>
        </div>

        <main class="main-content">
            <form action="{{ form_action }}" method="POST" enctype="multipart/form-data" class="new-game-form">
                <!-- Image Upload Container -->
                <div class="image-upload-container" onclick="triggerFileInput()">
                    <input type="file" id="game-image-input" name="game_image" accept="image/*"
                        onchange="previewImage(event)" hidden />
                    <div id="image-placeholder" {% if is_edit and game.image_data %}style="display:none"{% endif %}>
                        <span>Click to choose cover image</span>
                    </div>
                    <img id="image-preview" src="{{ game.image_data if is_edit else '' }}" alt="Game Cover Preview" {% if not is_edit or not game.image_data %}style="display:none"{% endif %} />
                </div>

                <div class="form-fields">
                    <div class="form-group">
                        <label for="game-name">GAME NAME</label>
                        <input type="text" id="game-name" name="game_name" placeholder="Enter game name"
                            value="{{ game.game_name if is_edit else '' }}" required />
                    </div>

                    <div class="form-group">
                        <label for="game-price">PRICE GAME</label>
                        <input type="text" id="game-price" name="game_price" placeholder="Enter price (e.g. 160.000)"
                            value="{{ game.game_price if is_edit else '' }}" required />
                    </div>

                    <div class="form-group">
                        <label for="game-genre">GENRE</label>
                        <select id="game-genre" name="game_genre" required>
                            <option value="" disabled {{ '' if is_edit else 'selected' }}>Select genre</option>
                            <option value="Action" {% if is_edit and game.game_genre == 'Action' %}selected{% endif %}>Action</option>
                            <option value="Adventure" {% if is_edit and game.game_genre == 'Adventure' %}selected{% endif %}>Adventure</option>
                            <option value="Casual" {% if is_edit and game.game_genre == 'Casual' %}selected{% endif %}>Casual</option>
                            <option value="Racing" {% if is_edit and game.game_genre == 'Racing' %}selected{% endif %}>Racing</option>
                            <option value="RPG" {% if is_edit and game.game_genre == 'RPG' %}selected{% endif %}>RPG</option>
                            <option value="Shooter" {% if is_edit and game.game_genre == 'Shooter' %}selected{% endif %}>Shooter</option>
                            <option value="Simulation" {% if is_edit and game.game_genre == 'Simulation' %}selected{% endif %}>Simulation</option>
                            <option value="Strategy" {% if is_edit and game.game_genre == 'Strategy' %}selected{% endif %}>Strategy</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="game-description">DESCRIPTION</label>
                        <textarea id="game-description" name="game_description" placeholder="Enter game description"
                            rows="4" required>{{ game.game_desc if is_edit else '' }}</textarea>
                    </div>

                    <!-- Optional: Status select -->
                    {% if is_edit %}
                    <div class="form-group">
                        <label for="game-status">STATUS</label>
                        <select id="game-status" name="game_status" required>
                            {% for status in statuses %}
                            <option value="{{ status.value }}" {% if game.status == status.value %}selected{% endif %}>
                                {{ status.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <div class="form-group">
                        <button type="submit" class="add-button">{{ 'Update' if is_edit else 'Add' }}</button>
                    </div>
                </div>
            </form>
        </main>
    </div>

    <script>
        function triggerFileInput() {
            document.getElementById('game-image-input').click();
        }

        function previewImage(event) {
            const input = event.target;
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.getElementById('image-preview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    document.getElementById('image-placeholder').style.display = 'none';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        window.onload = function() {
            const imgPreview = document.getElementById('image-preview');
            if (imgPreview.src && imgPreview.src !== window.location.href && imgPreview.src !== '') {
                imgPreview.style.display = 'block';
                document.getElementById('image-placeholder').style.display = 'none';
            }
        }
    </script>
</body>

</html>
